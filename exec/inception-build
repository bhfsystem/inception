#!/usr/bin/env bash

function main {
  local shome="${_inception_home:-"$(cd -P -- "${BASH_SOURCE%/*}/.." && pwd -P)"}"
  source "$shome/script/profile"
  source inception_common

  if [[ "$#" == 0 ]]; then
    set -- virtualbox vmware parallels
  fi

  for a in "$@"; do
    case "$a" in
      plane)
        a=virtualbox
        b=plane
        ;;
      virtualbox|van)
        a=virtualbox
        b=van
        ;;
      vmware|hotel)
        a=vmware
        b=hotel
        ;;
      parallels|snow) 
        a=parallels
        b=snow
        ;;
    esac
    $b $a recycle
    $b $a lxd init "${BASEBOX_LXD_NETWORK_PREFIX}"
    $b $a docker init inception "$BASEBOX_DOCKER_NETWORK_PREFIX" "$BASEBOX_NESTED_NETWORK_PREFIX"
    $b docker pull $CACHE_VIP:5000/inception:vagrant
    $b docker tag $CACHE_VIP:5000/inception:vagrant inception:vagrant
    $b $a reuse
  done
}

source sub "$BASH_SOURCE" "$@"
